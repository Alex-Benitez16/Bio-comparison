---
title: "evidence2"
output: html_document
date: "2025-05-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Library Loading

```{r echo=FALSE}
library(ade4)
library(ape)
library(adegenet)
library(Biostrings)
library(ggplot2)
library(dplyr)
library(ggplot2)
library(ggthemes)
library(ggrepel)
library(stringr)
```

Performing sequence loading

```{r}

countries <- list("usa", "china", "india", "france", "germany", "brazil", "south_korea", "japan", "italy", "uk")
sequences <- lapply(countries, function(x) readDNAStringSet(paste("./sequences/", x, ".fasta", sep="")))

print("The sequence lengths for each genome are as follows")
for (index in 1:length(sequences)) {
  print(
    paste(
      countries[[index]], " = ", width(sequences[[index]]), sep = ""
    )
  )
}

print("The frequencies for each base in each genome are as follows:")
for (index in 1:length(sequences)) {
  a_freq <- letterFrequency(sequences[[index]], 'A')
  c_freq <- letterFrequency(sequences[[index]], 'C')
  g_freq <- letterFrequency(sequences[[index]], 'G')
  t_freq <- letterFrequency(sequences[[index]], 'T')
  
  print(
    paste(
      countries[[index]], ": "
      , "A = ", a_freq
      , ", C = ", c_freq
      , ", G = ", g_freq
      , ", T = ", t_freq
      , ", Sum = ", a_freq + c_freq + g_freq + t_freq
      , sep = ""
    )
  )
}
```

Convert to data frame and graph

```{r}
sequence_dataframe <- data.frame(
  countries = countries,
  a_freq = lapply(sequences, function(seq) letterFrequency(seq, 'A')),
  c_freq = lapply(sequences, function(seq) letterFrequency(seq, 'C')),
  g_freq = lapply(sequences, function(seq) letterFrequency(seq, 'G')),
  t_freq = lapply(sequences, function(seq) letterFrequency(seq, 'T'))
)
```

```{r}
library(Biostrings)
library(tidyverse)

# Datos
countries <- c("usa", "china", "india", "france", "germany", "brazil", "south_korea", "japan", "italy", "uk")
Cases <- c(103436829, 99380363, 45043415, 39016278, 38437756, 37511921, 34571873, 33803572, 26826486, 24992089)
Deaths <- c(1201488, 122358, 533641, 168091, 174979, 702116, 35934, 74694, 197542, 232112)
Mortality <- Deaths / Cases * 100

# Leer secuencias
sequences <- lapply(countries, function(x) readDNAStringSet(paste("./sequences/", x, ".fasta", sep="")))

# Crear dataframe con características
genome_data <- data.frame(
  country = countries,
  mortality = Mortality,
  length = sapply(sequences, function(seq) sum(width(seq))),
  A = sapply(sequences, function(seq) sum(letterFrequency(seq, "A"))),
  C = sapply(sequences, function(seq) sum(letterFrequency(seq, "C"))),
  G = sapply(sequences, function(seq) sum(letterFrequency(seq, "G"))),
  T = sapply(sequences, function(seq) sum(letterFrequency(seq, "T")))
)

# Calcular frecuencias relativas
genome_data <- genome_data %>%
  mutate(total_bases = A + C + G + T,
         A_freq = A / total_bases,
         C_freq = C / total_bases,
         G_freq = G / total_bases,
         T_freq = T / total_bases)

# Gráfico: Mortalidad vs Longitud de secuencia
ggplot(genome_data, aes(x = length, y = mortality, label = country)) +
  geom_point(size = 3, color = "steelblue") +
  geom_text(vjust = -0.5) +
  labs(x = "Longitud total de secuencia", y = "Tasa de mortalidad (%)", title = "Mortalidad vs Longitud del genoma")

# Gráfico: Mortalidad vs Frecuencia de bases
library(ggrepel)

ggplot(genome_data_long, aes(x = Frequency, y = mortality, color = Base)) +
  geom_point(size = 3) +
  geom_text_repel(aes(label = country), size = 3) +
  labs(x = "Frecuencia relativa de base", y = "Tasa de mortalidad (%)", title = "Mortalidad vs Composición del genoma") +
  theme_minimal()

ggplot(genome_data_long, aes(x = Frequency, y = mortality, label = country)) +
  geom_point(size = 3, color = "steelblue") +
  geom_text_repel(size = 3) +
  facet_wrap(~ Base) +
  labs(x = "Frecuencia relativa de base", y = "Tasa de mortalidad (%)", title = "Mortalidad vs Composición del genoma") +
  theme_minimal()

```
